buildscript {
    repositories {
        jcenter()
	mavenCentral()
    }
    dependencies {
        classpath 'com.bmuschko:gradle-nexus-plugin:2.3.1'
    }
}


plugins {
	id 'com.bmuschko.nexus'
	id 'jacoco'
	id "org.sonarqube" version "2.8"
	id 'maven-publish'
	id 'java-library'
}

group 'co.com.bancolombia.commons.secretsmanager'
version System.getProperty('version')

repositories {
	mavenCentral()
}


dependencies {
	compile platform('software.amazon.awssdk:bom:2.13.10')
	compile 'software.amazon.awssdk:secretsmanager'
	compile group: 'com.google.code.gson', name: 'gson', version: '2.8.5'
	compileOnly 'org.projectlombok:lombok:1.18.12'
	annotationProcessor 'org.projectlombok:lombok:1.18.12'

	testCompileOnly 'org.projectlombok:lombok:1.18.12'
	testAnnotationProcessor 'org.projectlombok:lombok:1.18.12'
	testCompile 'org.mockito:mockito-core:2.28.2'
	testImplementation 'junit:junit:4.12'
}


jar {
    manifest.attributes provider: 'Ingenier√≠a de Software'
	archivesBaseName = 'secretsmanager'
	version = "$version"
}

sonarqube {
	properties {
		property "sonar.projectKey", "bancolombia_secrets-manager"
		property "sonar.organization", "grupo-bancolombia"
		property "sonar.host.url", "https://sonarcloud.io"
		property "sonar.sources", "src/main/java,build.gradle"
		property "sonar.java.binaries", "build/classes"
		property "sonar.junit.reportPaths", "build/test-results/test"
		property "sonar.java-coveragePlugin", "jacoco"
		property "sonar.coverage.jacoco.xmlReportPaths", "build/reports/jacoco/test/jacocoTestReport.xml"
		property "sonar.test", "src/test/java"
		property "sonar.exclusions", ".github/**"
		property "sonar.coverage.exclusions", "src/test/**"
		property "sonar.sourceEncoding", "UTF-8"
	}
}

jacocoTestReport {
	reports {
		xml.enabled true
	}
}

modifyPom {
    project {
        name 'teachUpload'
        description 'Teaching how to use gradle.'
        url 'https://bitbucket.org/objdict/objjson'
        inceptionYear '2018'

        scm {
            url 'https://bitbucket.org/objdict/objjson'
            connection 'scm:https://bitbucket.org/objdict/objjson.git'
            developerConnection 'scm:git://bitbucket.org/objdict/objjson.git'
        }

        licenses {
            license {
                name 'The Apache Software License, Version 2.0'
                url 'http://www.apache.org/licenses/LICENSE-2.0.txt'
                distribution 'repo'
            }
        }

        developers {
            developer {
                id 'albertgao'
                name 'Albert Gao'
                email 'albert.gao@salect.co.nz'
            }
        }
    }
}

extraArchive {
    sources = true
    tests = true
    javadoc = true
}


publishing {
	repositories {
		maven {
			name = "GitHubPackages"
			url = uri("https://maven.pkg.github.com/alejobtc/secrets-manager")
			credentials {
				username = project.findProperty("gpr.user") ?: System.getenv("GITHUB_ACTOR")
				password = project.findProperty("gpr.key") ?: System.getenv("GITHUB_TOKEN")
			}
		}
		maven {
		      name = "OSSRH"
		      url = "https://oss.sonatype.org/service/local/staging/deploy/maven2/"
		      credentials {
				username = project.findProperty("gpr.user") ?: System.getenv("MAVEN_USERNAME")
				password = project.findProperty("gpr.user") ?: System.getenv("MAVEN_PASSWORD")
		      }
    		}
	}
	
	publications {
		gpr(MavenPublication) {
			groupId "com.github.bancolombia"
			artifactId "secrets-manager"
			version "2.1.1"
			from(components.java)
		}
	}
}
